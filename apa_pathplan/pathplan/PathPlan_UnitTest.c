#include "PK_PathPlanP.h"
#include "PathPlan_Config.h"
#include "PathPlan_Update.h"
#include "PathPlan_Obj.h"
#include "PK_ObjAvoid.h"
#include "PK_Calibration.h"
#include "MathFunc.h"
#include "PK_Utility.h"

#if defined(SIMULATE)
static void PointTAvmSlot(const float points[8], Avm_Pot_T &avmPot)
{
    avmPot.near_rear.x  = points[0];
    avmPot.near_rear.y  = points[1];
    avmPot.far_rear.x   = points[2];
    avmPot.far_rear.y   = points[3];
    avmPot.far_front.x  = points[4];
    avmPot.far_front.y  = points[5];
    avmPot.near_front.x = points[6];
    avmPot.near_front.y = points[7];
}

static void BuildFsObj(float *objs, int objsNum, int FS_ObjDir[FS_OBJ_ARR_NUM],
                       float FS_Obj[FS_OBJ_ARR_NUM][4], int objType)
{
    int count = 0;
    while (count < objsNum / 4)
    {
        FS_ObjDir[count] = objType;
        memcpy(FS_Obj[count], &objs[4 * count], sizeof(float) * 4);
        count++;
    }
}

extern int PathPlan_RangeDataProcess(PlanDataCase PlanData_Ver[1], const SlotInfo_T &slot,
                                     const int FS_ObjDir[FS_OBJ_ARR_NUM],
                                     const float FS_Obj[FS_OBJ_ARR_NUM][4],
                                     const int FS_ObjDir_Rear[FS_OBJ_ARR_NUM],
                                     const float FS_Obj_Rear[FS_OBJ_ARR_NUM][4]);

void PathPlan_RangeDataProcess_UnitTest()
{
    int FS_ObjDir[FS_OBJ_ARR_NUM], FS_ObjDir_Rear[FS_OBJ_ARR_NUM];
    float FS_Obj[FS_OBJ_ARR_NUM][4], FS_Obj_Rear[FS_OBJ_ARR_NUM][4];
    PK_SlotShapeType slottype = PK_SLOT_LEFT_VERT;

    float slotdata[] = {5.890372, 2.743933, 7.785791,  3.017086,  6.977760,  8.624080,
                        9.917944, 9.047793, 10.726054, 3.440263,  12.621472, 3.713414,
                        8.791281, 7.020358, -1.427670, 8.031354,  3.221116,  7.277467,
                        8.452394, 9.839147, 8.821562,  10.593034, 3.59028};
    float curpos[]   = {14.414434, 1.283720, 0.114292};
    float objs[]     = {0.260336,  -4.128098, 0.793243,  -4.124103, 9.953655,  -2.347926,
                        14.690064, -1.611046, 15.298779, -3.860247, 15.632317, -3.830716,
                        16.056650, -3.786203, 16.383179, -3.751150};

    SlotInfo_T slot;
    PointTAvmSlot(&slotdata[15], slot.avm_point);
    memcpy(&slot.slotobj, &slotdata[0], sizeof(float) * 12);
    memcpy(&slot.targpos, &slotdata[12], sizeof(float) * 3);
    slot.slotshap = slottype;

    PlanDataCase planData[1];
    memcpy(&planData[0].finpoint, &slotdata[12], sizeof(float) * 3);
    memcpy(&planData[0].stpoint, curpos, sizeof(float) * 3);
    planData[0].slotshape = slottype;

    memset(FS_ObjDir, 0, sizeof(FS_ObjDir));
    memset(FS_ObjDir_Rear, 0, sizeof(FS_ObjDir_Rear));

    BuildFsObj(objs, sizeof(objs) / sizeof(objs[0]), FS_ObjDir, FS_Obj, OBJTYPE_LEFT);

    PathPlan_RangeDataProcess(planData, slot, FS_ObjDir, FS_Obj, FS_ObjDir_Rear,
                              FS_Obj_Rear);
}

extern int UpdateSlotWithObsInSlot(SlotInfo_T &slot, int FS_ObjDir[FS_OBJ_ARR_NUM],
                                   float FS_Obj[FS_OBJ_ARR_NUM][4],
                                   int FS_ObjDir_Rear[FS_OBJ_ARR_NUM],
                                   float FS_Obj_Rear[FS_OBJ_ARR_NUM][4]);

void PathPlan_UpdateSlotWithObsInSlot_UnitTest()
{
    int FS_ObjDir[FS_OBJ_ARR_NUM], FS_ObjDir_Rear[FS_OBJ_ARR_NUM];
    float FS_Obj[FS_OBJ_ARR_NUM][4], FS_Obj_Rear[FS_OBJ_ARR_NUM][4];
#if 0
    PK_SlotShapeType slottype = PK_SLOT_RIGHT_VERT;
    float slotdata[] = {23.348560,-5.576983,25.260502,-5.468820,25.575823,-11.042529,28.281382,-10.889468,27.991909,-5.772693,29.903854,-5.664529,26.804247,-8.927025,1.627309,25.230812,-5.555257,25.565165,-11.465375,28.244930,-11.313773,27.910578,-5.40365};
    float objs[] = {0.779170,1.324746,-0.443135,1.654331};

    float objs[] = {18.939831,45.819126,18.556145,46.576736};
    float target[] = {15.424715,47.761662,0.050731};
    float avm[] = {19.007629,49.214951,13.604563,48.940617,13.736855,46.335121,19.139921,46.609455};

    float objs[] = {24.911634,45.735584,24.882437,46.736675};
    float target[] = {27.824402,44.468658,-3.115891};
    float avm[] = {24.432875,45.711891,29.853462,45.851242,29.920080,43.259865,24.499493,43.120514};
#endif

    PK_SlotShapeType slottype = PK_SLOT_LEFT_PARA;
    float objs[]   = {-0.4830, 3.5232,  1.2416,  3.7264, 1.2973,  3.6806, 2.7621,  3.5408,
                      3.2174,  3.9448,  6.8585,  4.1281, 6.8992,  4.1468, 10.1362, 4.2808,
                      10.4732, 4.3067,  10.5470, 4.2947, 10.8004, 4.3344, 11.0083, 4.2997,
                      12.4369, 4.4032,  12.5654, 4.3721, 11.9415, 0.5541, 12.9761, 0.3691,
                      3.2305,  -4.2541, 3.4954,  -4.2303};
    float target[] = {5.9957, 2.6339, 0.0522};
    float avm[]    = {4.4524, 1.6144, 4.3353, 3.8550, 10.2909, 4.1663, 10.4080, 1.9258};

    SlotInfo_T slot;
    PointTAvmSlot(avm, slot.avm_point);
    memcpy(&slot.targpos, target, sizeof(float) * 3);
    slot.slotshap = slottype;

    memset(FS_ObjDir, 0, sizeof(FS_ObjDir));
    memset(FS_ObjDir_Rear, 0, sizeof(FS_ObjDir_Rear));
    int objNum = sizeof(objs) / sizeof(objs[0]) / 4;
    for (int i = 0; i < objNum; i++)
    {
        FS_ObjDir[i] = 10000;
        memcpy(FS_Obj[i], &objs[4 * i], 4 * sizeof(float));
    }

    UpdateSlotWithObsInSlot(slot, FS_ObjDir, FS_Obj, FS_ObjDir_Rear, FS_Obj_Rear);
}

void PathPlan_UpdatePlanPath_UnitTest()
{
#if 0
    bool updateTarget = false;

    float objs[] = {-0.810893,1.442779,0.990722,0.956989,0.61319,1.368255,1.876293,1.352334,1.33554,1.341568,2.977867,1.351729,3.061815,1.385862,6.052127,1.32446,5.91247,2.623985,6.933336,1.983767,5.748962,-0.309914,7.298288,-1.494983,7.433465,-1.117107,8.351196,-0.851143,10.14617,-0.652947,10.867036,-0.501632,12.02094,-0.734242,15.241638,-0.893961,6.042171,-5.601449,7.816007,-6.306189,14.919234,0.121074,29.896603,0.944783};
    float points[] = {11.749639,-3.363856,-0.011357,10.113711,-9.757723,1.625738,};
    float trajs[] = {10.728152,-3.341771,-0.032027,3.555363,0.0,14.281693,-3.455621,-0.032027,-4.734375,-5.8,9.999481,-5.146697,0.784244,0.929688,5.4,10.597997,-4.436792,0.956409,-0.742187,-5.4,10.213114,-5.070701,1.093851,0.452435,5.4,10.403935,-4.66061,1.186443,-2.635767,-5.999999,9.975236,-7.23985,1.625738,-2.521678,0.0,};

    float points[] = {26.194422,-3.051036,0.026472,10.11371,-9.757723,1.625738,};
    float objs[] = {14.398524,-3.314187,0.047031,-0.416959,0.0,13.982026,-3.33379,0.047031,-4.453125,-5.8,10.034648,-5.148543,0.814811,0.738281,5.4,10.502874,-4.578477,0.95153,-0.566406,-5.4,10.19888,-5.056086,1.05642,0.556975,5.4,10.447595,-4.557991,1.167531,-2.749241,-6.0,9.975355,-7.242017,1.625738,-2.519508,0.0,};
    float trajs[] = {-0.810894,1.44278,0.990723,0.956988,0.61319,1.368256,1.876293,1.352334,1.335539,1.341568,2.977867,1.351728,3.061815,1.385862,6.052128,1.32446,5.91247,2.623985,6.933336,1.983767,5.748962,-0.309914,7.298288,-1.494983,7.433464,-1.117107,8.351196,-0.851143,10.14617,-0.652947,10.867036,-0.501632,12.054072,-0.834042,17.271271,-0.787008,16.710531,-0.712715,18.071226,-0.539223,17.421543,1.872644,18.664553,1.92079,18.152254,-0.518033,21.842283,-0.414319,6.042171,-5.601449,7.816008,-6.306189,29.307392,0.912378,44.28476,1.736088};

    float points[] = {9.169569,-33.485664,3.098777,10.352637,-27.698393,-1.572422,};
    float trajs[] = {9.169569,-33.485664,3.098777,0.3,0.0,8.869843,-33.472824,3.098777,2.825829,10.022402,6.066517,-33.747265,3.398777,-5.746501,-7.3,10.521362,-30.355183,4.185969,1.2,5.4,10.038191,-31.450914,4.408192,-0.120095,0.0,10.074162,-31.336332,4.408192,-1.815437,-6.000012,10.349629,-29.548914,-1.572422,-1.850523,0.0,};
    float objs[] = {23.351696,-38.901478,19.479982,-38.868462,19.839941,-38.786671,17.508583,-38.991417,17.969015,-36.021881,13.706253,-35.882504,14.245934,-35.899254,12.40748,-35.947029,12.000998,-39.086403,11.122768,-39.062157,7.664798,-37.942131,5.303012,-37.925995,21.903887,-31.497362,19.701143,-31.546352,15.796898,-31.187986,13.754654,-31.202663,9.295308,-30.112,8.214331,-30.073193,5.82675,-37.29105,-9.17323,-37.26667};


    float points[] = {5.606638,-0.023371,0.003793,3.960088,-5.921288,1.621156,};
    float trajs[] = {5.610395,-0.02337,0.003532,0.12,0.0,5.906636,-0.022233,0.003793,1.68,5.6,7.560588,0.234157,0.303793,0.5,0.0,8.037693,0.383727,0.303793,0.045501,0.0,7.994276,0.370116,0.303793,-7.640708,-5.8,3.93665,-5.45626,1.621156,-0.465619,0.0,};
    float objs[] = {4.89164,3.316397,6.412509,3.127078,8.372453,3.913294,23.353437,4.668376,};

    float points[] = {6.411484,2.904607,0.19243,6.394068,8.88694,-1.596375,};
    float trajs[] = {6.411484,2.904607,0.19243,0.370856,5.8,6.77298,2.987116,0.25637,1.750007,-5.8,8.50668,3.171049,-0.060549,1.64929,0.0,10.152946,3.071247,-0.060549,-4.5,5.6,6.232879,5.024854,-0.864121,1.066406,-5.2,6.837592,4.148746,-1.069199,-1.230469,5.2,6.378509,5.287275,-1.305827,0.3,-5.2,6.448679,4.99564,-1.36352,-1.340178,5.710444,6.328583,6.327341,-1.596375,-2.560436,0.0,};
    float objs[] = {3.393747,5.255422,5.340795,5.937217,-0.701047,-1.115145,1.691074,-1.069232,2.821481,-1.90677,3.808621,-1.750426,3.795589,-2.062913,5.288082,-2.099858,3.795589,-2.062913,5.288082,-2.099858,5.289233,-0.07294,5.742653,0.796293,6.487502,0.715993,6.990379,0.635462,8.539522,0.959844,10.078497,0.899151,9.371552,-0.792377,24.366646,-1.176012,};

    float points[] = {37.458435,-15.030358,-3.059374,38.644787,-8.924277,-1.480064,};
    float trajs[] = {37.974361,-14.987468,-3.057462,0.3,0.0,37.675423,-15.012677,-3.057462,2.4192,8.064001,35.331039,-15.571824,-2.757462,0.5,0.0,34.867477,-15.759201,-2.757462,0.270011,0.0,38.720387,-9.755165,-1.480064,7.408908,-5.799999,38.720383,-9.755164,-1.480064,-0.834318,0.0};
    float objs[] = {50.285042,-17.660839,48.740231,-17.714506,41.291046,-18.202681,40.453308,-18.17054,34.871197,-18.907261,19.932898,-20.266384};
    bool updateTarget = false;

    PK_SlotShapeType slottype = PK_SLOT_RIGHT_VERT;
    float points[] = {-19.1677094, 12.3338213, -2.84420919, -17.424017, 19.3737926, -1.27558529};
    float trajs[] = {-17.7352962, 12.7724218, -2.84553504, 0.300000012, 0, 
                     -18.0222454, 12.6848965, -2.84553504, 1.68000007, 5.5999999, 
                     -19.5321884, 11.9628372, -2.54553509, 3.90231419, 0, 
                     -22.76157, 9.77213955, -2.54553509, -10.0312519, -15.5999994, 
                     -16.7695694, 17.6017036, -1.90250611, 1.20000005, 5.19999981, 
                     -17.0234222, 16.4644356, -1.67794371, -2.33368063, -5.80000448, 
                     -17.2410641, 18.7721653, -1.27558529, -0.628830671, 0};

    float objs[] = {-6.31657887, 11.3006277, -6.66750145, 13.029624, 
                    -12.806735, 10.7198868, -14.5425701, 10.1412182, 
                    -14.2340555, 10.2137117, -18.8970146, 8.93872166, 
                    -18.6432953, 9.8449173, -20.2424221, 9.44098091, 
                    -19.637394, 9.00282478, -21.1041431, 8.44145393, 
                    -13.9141388, 18.021204, -15.3568268, 17.6132011, 
                    -20.1951752, 14.6168776, -21.858511, 14.1553316, 
                    -20.9784145, 8.25884533,-35.329525, 3.89471912};

    PK_SlotShapeType slottype = PK_SLOT_LEFT_PARA;
    float points[] = {-12.9367199, -2.09990311, -2.9511764, 6.01014709, -2.68938565, -2.98489976};
    float trajs[] = {-12.5038662, -2.01760411, -2.95644689, -9.49018955, 0,
                     -3.17586899, -0.270556927, -2.95644689, -4.84964085, 5.79999876,
                     1.40654469,-1.35765576, -3.79259205, -0.84114635, 0,
                     2.07565856, -1.86737514, -3.79259205, -4.20000029, -5.19999981};

    float objs[] = {-1.19158554, -2.56308317, -6.73674011, -3.26078987,
                    11.6311541, 4.69228506, 9.48431301, 4.15376139,
                    6.65238333, 5.16554642, 5.17080688, 4.91203308,
                    5.95994616, 3.63944578, 3.31111741, 3.04125643,
                    0.964909971, 2.95247293, -1.28158295, 2.40433812,
                    -1.17554522, 2.00594544, -2.10716057, 1.71138477,
                    -2.47518992, 2.88032246, -4.79150295, 2.26856661};
#endif

    float trajs[] = {7.16120434, 0.164955258, 0.0286804903, -4.73000002, 5.80000019,
                     2.88776565, 1.86725473,  -0.786836743, 2.55000305,  -5.80000019,
                     4.24025202, -0.2703197,  -1.2264924,   -4.19000006, 5.80000019,
                     4.30954266, 3.82857537,  -1.94890618,  3.29999971,  -5.80000019,
                     2.306777,   1.26180696,  -2.51787162,  -2.83434653, 0,
                     4.60744667, 2.91723442,  -2.51787162,  -5.38599825, -5.51689339,
                     6.89979458, 7.55641794,  -1.54159784,  -0.5,        0};

    PK_SlotShapeType slottype = PK_SLOT_LEFT_VERT;
    float objs[]              = {-0.110665582, -1.71651125, 1.3858695,  -1.71111131,
                                 8.12803745,   -1.94421649, 9.98949814, -1.77958941};
    float slotobjs[] = {-1.14749777, 7.08928299,  0.351862758, 7.13307476,  0.351862758,
                        7.13307476,  0.283898115, 9.46008301,  0.283898115, 9.46008301,
                        8.26517582,  9.69319153,  8.26517582,  9.69319153,  8.39804173,
                        5.14405107,  8.39804173,  5.14405107,  9.89740276,  5.18784285};

    float points[] = {7.16120434, 0.164955258, 0.0286804903,
                      6.88519764, 8.0562048,   -1.54159784};

    bool updateTarget = false;
    PlanDataCase planData;
    memcpy(&planData.finpoint, &points[3], sizeof(float) * 3);
    memcpy(&planData.stpoint, &points[0], sizeof(float) * 3);
    planData.slotshape = slottype;

    int objNum = sizeof(objs) / sizeof(float) / 4;

    planData.obj_danger_num = objNum;
    for (int i = 0; i < objNum; i++)
    {
        planData.obj_danger_dir[i] = 2;
        memcpy(planData.obj_danger[i], &objs[i * 4], sizeof(float) * 4);
    }

    for (int i = 0; i < 5; i++)
    {
        memcpy(planData.obj_slot[i], &slotobjs[i * 4], sizeof(float) * 4);
    }

    PlanedPath lastPath;
    int trajNum        = sizeof(trajs) / sizeof(float) / 5;
    lastPath.pathNum   = trajNum;
    lastPath.slotIndex = 1000;
    for (int i = 0; i < trajNum; i++)
    {
        memcpy(lastPath.trajs[i], &trajs[i * 5], sizeof(float) * 5);
    }

    float paths[4 * MAX_SINGLE_TRAJ_NUM][TRAJITEM_LEN] = {{0.0f}};
    memset(paths, 0, sizeof(paths));
    int pathNum = PathPlan_UpdatePlanPath(lastPath, planData, paths, updateTarget);
    printf("pathNum = %d \n", pathNum);
}

void PK_Check_Path_UnitTest()
{
#if 0
    float points[] = {6.411484,2.904607,0.19243,6.394068,8.88694,-1.596375,};
    float trajs[] = {6.411484,2.904607,0.19243,0.370856,5.8,6.77298,2.987116,0.25637,1.750007,-5.8,8.50668,3.171049,-0.060549,1.64929,0.0,10.152946,3.071247,-0.060549,-4.5,5.6,6.232879,5.024854,-0.864121,1.066406,-5.2,6.837592,4.148746,-1.069199,-1.230469,5.2,6.378509,5.287275,-1.305827,0.3,-5.2,6.448679,4.99564,-1.36352,-1.340178,5.710444,6.328583,6.327341,-1.596375,-2.560436,0.0,};
    float objs[] = {3.393747,5.255422,5.340795,5.937217,-0.701047,-1.115145,1.691074,-1.069232,2.821481,-1.90677,3.808621,-1.750426,3.795589,-2.062913,5.288082,-2.099858,3.795589,-2.062913,5.288082,-2.099858,5.289233,-0.07294,5.742653,0.796293,6.487502,0.715993,6.990379,0.635462,8.539522,0.959844,10.078497,0.899151,9.371552,-0.792377,24.366646,-1.176012,};
#endif

    float points[] = {
        24.71583, 3.025456, -0.035009, 25.582565, 8.975398, -1.589296,
    };
    float trajs[] = {
        24.713049, 3.025552,  -0.035009, 0.658965,  0.0,      25.074379, 3.012898,
        -0.035009, 3.223471,  -6.009124, 28.114038, 2.061873, -0.571439, -5.7,
        5.6,       25.543718, 6.875757,  -1.589296, -2.1,     0.0,
    };
    float objs[] = {
        23.192646, 5.167518,  24.494497, 5.817294,  13.862267, 0.273903,  18.476555,
        0.342312,  21.272451, 0.075357,  25.269199, 0.071739,  25.466698, -2.390068,
        26.931742, -2.379641, 27.552216, -0.662686, 42.549648, -0.940166,
    };

    PlanDataCase planData;
    memcpy(&planData.finpoint, &points[3], sizeof(float) * 3);
    memcpy(&planData.stpoint, &points[0], sizeof(float) * 3);

    int objNum              = sizeof(objs) / sizeof(float) / 4;
    planData.obj_danger_num = objNum;
    for (int i = 0; i < objNum; i++)
    {
        planData.obj_danger_dir[i] = 1;
        memcpy(planData.obj_danger[i], &objs[i * 4], sizeof(float) * 4);
    }

    int trajNum                                    = sizeof(trajs) / sizeof(float) / 5;
    float paths[MAX_SINGLE_TRAJ_NUM][TRAJITEM_LEN] = {{0.0f}};
    for (int i = 0; i < trajNum; i++)
    {
        memcpy(paths[i], &trajs[i * 5], sizeof(float) * 5);
    }

    PK_Check_Path(trajNum, paths, planData.stpoint, planData.finpoint,
                  planData.obj_danger_num, planData.obj_danger, 0);
}

extern int PK_PathMerge(float trajs[MAX_SINGLE_TRAJ_NUM][TRAJITEM_LEN], const int lineNum,
                        const int slotid);
void PK_PathMerge_UnitTest()
{
    // float trajs[] =
    // {13.017647,0.140527,0.068422,0.09,0.0,13.331473,0.162033,0.068422,1.74,-5.8,15.059192,0.020776,-0.231578,-6.960138,0.0,8.284851,1.618224,-0.231578,-4.335937,5.8,4.801883,4.028588,-0.979153,3.5,-5.4,5.711127,0.711905,-1.627301,-0.786852,5.4,5.812542,1.491492,-1.773015,-2.011307,0.0,6.2165,3.461816,-1.773015,-1.57112,-6.057301,6.330035,5.024416,-1.513639,-0.5,0.0,};
    // float trajs[] = {-0.5594666, 18.0545177, -3.06232667, 0.300000012, 0,
    // -0.85852468, 18.0307636, -3.06232667, 1.74000013, -5.80000019,
    // -2.58767271, 18.1532784,-3.36232662, 2.12822819, 0, -4.66426373, 18.6192455,
    // -3.36232662, -1.99620008, 0, -2.71649742, 18.1821861, -3.36232662,
    // -7.59529448, 5.99999952, 1.94858229, 12.8322468, 1.65497637, -1.17897916, 0};

    // line merge
#if 0    
    float trajs[] = {
    60.0116081, 4.55827856, 0.0981151164, 0.300000012, 0, 
    60.3101654, 4.58766603, 0.0981151164, 3.5, -28.8947811, 
    63.8055573, 4.7189827,  -0.0230140239, -1.99297094, 0, 
    61.8131142, 4.76484489, -0.0230140239, -4.89621973, 5.5999999, 
    57.5646286, 6.87068558, -0.897338986,  1.25781226, -5.19999981, 
    58.2231598, 5.80263424, -1.13922596, -2.87773156, 5.19999981, 
    57.7849236, 8.60978222, -1.69263589, -0.160938382, 0, 
    57.8044853, 8.76952744, -1.69263589, -1.25481653, -5.90742254, 
    57.8240623, 10.0218334, -1.48022234, -0.5, 0};
#endif
    float trajs[] = {2.50258183,  31.8965149,
                     1.55853319,  -0.0217144322,
                     -5.80000019, 2.50235677,
                     31.8748016,  1.56227708,
                     -16.0244617, 0,
                     2.3658421,   15.8509216,
                     1.56227708,  -0.585200191,
                     5.80000019,  2.33136797,
                     15.2669859,  1.46138048,
                     3.2841301,   0,
                     2.68998718,  18.531477,
                     1.46138048,  -6.01118803,
                     -5.79999971, 4.9739151,
                     13.2591724,  2.49779224,
                     -1.21880841, 0,
                     5.94874287,  12.5275955,
                     2.49779224,  -0.900000036,
                     5.19999981,  6.61836052,
                     11.9279356,  2.32471538,
                     1,           -5.19999981,
                     6.00795174,  12.7180777,
                     2.13240767,  -1.77612627,
                     5.19999981,  6.68129396,
                     11.0838547,  1.79084492,
                     0.950865865, -5.19999981};

    int trajNum                                    = sizeof(trajs) / sizeof(float) / 5;
    float paths[MAX_SINGLE_TRAJ_NUM][TRAJITEM_LEN] = {{0.0f}};
    for (int i = 0; i < trajNum; i++)
    {
        PK_CopyTra(paths[i], &trajs[i * 5]);
    }

    // 2aê??·??o?2￠
    is_save_log = 0;
    float finpoint[3];

    PK_Get_Path_EndPos(paths[trajNum - 1], finpoint);
    auto result1 = PK_Check_Path(trajNum, paths, paths[0], finpoint, 0, NULL, 0);
    int trajNum2 = PK_PathMerge(paths, trajNum, 1);
    PK_Get_Path_EndPos(paths[trajNum2 - 1], finpoint);
    auto result2 = PK_Check_Path(trajNum2, paths, paths[0], finpoint, 0, NULL, 0);
    printf("result1 = %d %d result2=%d %d\n", result1, trajNum, result2, trajNum2);
}

void PK_PathMerge_UnitTest2() {}

void PathPlan_UnitTest()
{

    int obj_danger_num    = 11;
    float obj_danger[][4] = {{5.40120506, 1.96118784, 6.42991161, 2.03724527},
                             {6.72155666, 2.04494333, 7.94901514, 2.05939341},
                             {14.7521238, 2.97078657, 16.0517349, 3.00261354},
                             {3.19133186, -3.72398233, 5.2791214, -3.42667437},
                             {5.07546043, -3.53051996, 6.06646061, -3.50880671},
                             {6.02371311, -3.59483767, 9.14877415, -3.4534812},
                             {8.57562065, -3.34933615, 10.4882431, -3.10479403},
                             {10.1808224, -3.12272692, 11.1737556, -3.38039923},
                             {12.4362211, -3.56086206, 14.3826065, -3.43374491},
                             {15.1595297, -2.38884592, 25.1565323, -2.14402151},
                             {15.1700306, -1.29111528, 15.0514936, 2.70712805}};
    float stpoint[]       = {11.4273014, 0.100647926, -0.589001238, -1.43992257};
    float finpoint[]      = {12.2190485, 3.97695422, -2.19293952};
    float obj_slot[][4]   = {{8.68619347, 2.74881673, 10.1857443, 2.78554034},
                             {10.1857443, 2.78554034, 10.0456705, 8.50522041},
                             {10.0456705, 8.50522041, 14.5638599, 8.61587048},
                             {14.5638599, 8.61587048, 14.702137, 2.96956277},
                             {14.702137, 2.96956277, 16.2016869, 3.00628686}};
    float pointf_danger[] = {14.702137, 2.96956277, 0.0244848728};
    float pointb_danger[] = {10.1857443, 2.78554034, 0.0244848728};
    float close_side_dist = 2.7545464;
    float len             = 4.99800014;
    float width           = 1.91499996;
    float h               = 1.06599998;
    float swell           = 0;
    float left_fac        = 1;
    int slotshape         = 3;
    float front_dist      = 0.599998593;
    float rear_dist       = 2.7545464;
    float rect_ds_max     = 2.35454631;
    float rear_safe_dist  = 2.35454631;
    int is_vision_slot    = 1;
    int has_stopper       = 0;

    int trajsNum     = 32;
    float trajs[][5] = {
        {11.080533, 0.58852005, 0.0296386778, -1.5, 9.17765236},
        {9.5832634, 0.646136284, -0.133801788, 2, -6.11400604},
        {11.4986401, 0.101750374, -0.460919559, -0.500000298, 9.17765236},
        {11.0539265, 0.330195904, -0.515399754, 0.481999815, -6.11400604},
        {11.4273014, 0.100647926, -0.589001238, -1.43992257, 7.9333787},
        {10.3089695, 1.0045414, -0.770503044, 0.499999881, -6.11400604},
        {10.6604824, 0.649105072, -0.852282465, -1, 9.17765236},
        {10.0338058, 1.42778969, -0.961242795, 0.500000238, -6.11400604},
        {10.3115587, 1.01215887, -1.04302227, -0.499999195, 9.17765236},
        {10.0656815, 1.44747353, -1.09750235, 0.500000238, -6.11400604},
        {10.2844009, 0.997964144, -1.17928183, -0.500000298, 9.17765236},
        {10.0999355, 1.46264362, -1.23376203, 0.500000238, -6.11400604},
        {10.2555676, 0.987591386, -1.31554151, -0.499999523, 6.39491987},
        {10.1388245, 1.47367334, -1.39372849, 0.500000238, -6.11400604},
        {10.2167997, 0.979894876, -1.47550797, -0.500000298, 9.17765236},
        {10.1760139, 1.47818422, -1.52998817, 0.499999523, -6.11400604},
        {10.1861935, 0.978389978, -1.61176753, -0.500000298, 9.17765236},
        {10.2134724, 1.47760105, -1.66624773, 0.500000238, -6.11400604},
        {10.1556664, 0.981058598, -1.74802721, -0.499999672, 7.7683754},
        {10.2517128, 1.47168112, -1.81239069, 0.500000238, -6.11400604},
        {10.1222143, 0.988850117, -1.89417017, -0.499999195, 9.17765236},
        {10.2875252, 1.46068287, -1.94865024, 0.500000954, -6.11400604},
        {10.0936403, 0.999917984, -2.03042984, -0.703127027, 9.17765236},
        {12.2190485, 3.97695422, -2.19293952, -1.3281256, -6.11400604},
        {12.9043722, 5.10935116, -1.97571278, -2.00000024, -6.11400604},
        {13.4197464, 7.03273344, -1.64859498, 2.57692623, 0},
        {13.2194672, 4.46360207, -1.64859498, 1.68397772, 23.5197639},
        {13.148777, 2.78146601, -1.57699656, 1.61328101, 5.19999981},
        {13.3871861, 1.19243193, -1.26675022, -2.0420351, 5.19999981},
        {13.1690979, 3.20961571, -1.65944934, -2.18223739, 0},
        {13.3623066, 5.38328314, -1.65944934, -1.28894985, -11.3927383},
        {13.4036322, 6.67088175, -1.5463115, -0.5, 0},
    };

    PlanDataCase planData;
    planData.slotshape       = slotshape;
    planData.front_dist      = front_dist;
    planData.rear_dist       = rear_dist;
    planData.close_side_dist = close_side_dist;
    planData.left_fac        = left_fac;
    planData.width           = width;
    planData.len             = len;
    planData.h               = h;
    planData.swell           = swell;
    planData.has_stopper     = has_stopper;
    planData.is_vision_slot  = is_vision_slot;
    planData.rect_ds_max     = rect_ds_max;
    planData.obj_danger_num  = obj_danger_num;
    memcpy(planData.obj_slot, obj_slot, sizeof(planData.obj_slot));
    memcpy(planData.obj_danger, obj_danger, sizeof(obj_danger));
    memcpy(planData.stpoint, stpoint, sizeof(stpoint));
    memcpy(planData.finpoint, finpoint, sizeof(finpoint));
    memcpy(planData.pointf_danger, pointf_danger, sizeof(pointf_danger));
    memcpy(planData.pointb_danger, pointb_danger, sizeof(pointb_danger));

    float tempTrajs[MAX_SINGLE_TRAJ_NUM][TRAJITEM_LEN];
    memcpy(tempTrajs, trajs, sizeof(trajs));
    int tempTrajsNum = trajsNum;

    // 连接断头轨迹
    float Exp_traj[20][TRAJITEM_LEN];
    int IsDirConnect = 0;

    int i = 12;
    float endPos[3];
    int check3;

    for (i = 0; i < tempTrajsNum - 1; i++)
    {
        PK_Get_Path_EndPos(tempTrajs[i], endPos);
        check3 = PathPlan_CheckPosDiv(endPos, tempTrajs[i + 1]);
        if (check3 != 0)
        {
            printf("traj %d breaked\n", i);
        }
    }

    int breaked = 22;
    PK_Get_Path_EndPos(tempTrajs[breaked], endPos);
    int pathNum;
    int path1 = PathPlan_TwoCircleCon(tempTrajs[breaked], tempTrajs[breaked + 2], 0,
                                      planData.obj_slot, Exp_traj, 0.0);
    int path2 = PathPlan_TwoCircleCon(tempTrajs[breaked], tempTrajs[breaked + 2], 5,
                                      planData.obj_slot, Exp_traj, 0.0);

    memcpy(planData.stpoint, tempTrajs[breaked], sizeof(PlanDataCase::finpoint));
    memcpy(planData.finpoint, tempTrajs[breaked + 1], sizeof(PlanDataCase::finpoint));
    int path3  = PathPlan_SpaceExplorer_Vert(&planData, Exp_traj, &IsDirConnect, 1);
    auto check = PK_Check_Path(path3, Exp_traj, planData.stpoint, planData.finpoint,
                               planData.obj_danger_num, planData.obj_danger, 0.0);

    // memcpy(planData.finpoint, tempTrajs[breaked + 2], sizeof(PlanDataCase::finpoint));
    // int path4 = PathPlan_SpaceExplorer_Vert(&planData, Exp_traj, &IsDirConnect, 1);

    for (int i = 0; i < pathNum; i++)
    {
        float dist = PathPlan_LandMark(Exp_traj[i], 5, planData.obj_slot, 0);
    }

    pathNum = PathPlan_TwoCircleCon(endPos, tempTrajs[breaked + 1], 5, planData.obj_slot,
                                    Exp_traj, 0.0);
}
#endif
